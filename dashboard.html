<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°åŒºç‰©ä¸šåå°ç®¡ç†ç³»ç»Ÿ - é¦–é¡µ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <h1>LOGO</h1>
            <p>å°åŒºç‰©ä¸šåå°ç®¡ç†</p>
        </div>
        <div class="menu">
             <a href="dashboard.html" class="menu-item">
                 <i>ğŸ“„</i> é¦–é¡µ
             </a>
             <a href="monitoring.html" class="menu-item">
                 <i>ğŸšª</i> é—¨ç¦ç›‘æ§
             </a>
             <a href="owner-management.html" class="menu-item">
                 <i>ğŸ¢</i> ä¸šä¸»ç®¡ç†
             </a>
             <a href="work-order.html" class="menu-item"> 
                 <i>ğŸ“</i> å·¥å•ç®¡ç†
             </a>
             <a href="visitor-management.html" class="menu-item">
                 <i>ğŸ‘¥</i> è®¿å®¢ç®¡ç†
             </a>
             <a href="appointment-management.html" class="menu-item">
                 <i>ğŸ“…</i> é¢„çº¦ç®¡ç†
             </a>
             <a href="parking-management.html" class="menu-item">
                 <i>ğŸ…¿ï¸</i> è½¦ä½ç®¡ç†
             </a>
        </div>
    </div>

    <div class="main-content">
        <!-- Content from original #dashboard-view starts here -->
        <div class="header-bar">
            <div class="search-bar">
                <input type="text" placeholder="æœç´¢...">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #666; margin-left: 5px;">
                    <path d="M11.7422 10.3438H11.1094L10.875 10.125C11.6562 9.21875 12.125 8.0625 12.125 6.8125C12.125 4.15625 9.96875 2 7.3125 2C4.65625 2 2.5 4.15625 2.5 6.8125C2.5 9.46875 4.65625 11.625 7.3125 11.625C8.5625 11.625 9.71875 11.1562 10.625 10.375L10.8438 10.6094V11.2422L14.8438 15.25L16.25 13.8438L11.7422 10.3438ZM7.3125 10.3438C5.40625 10.3438 3.875 8.8125 3.875 6.8125C3.875 4.8125 5.40625 3.28125 7.3125 3.28125C9.21875 3.28125 10.75 4.8125 10.75 6.8125C10.75 8.8125 9.21875 10.3438 7.3125 10.3438Z" fill="currentColor"/>
                </svg>
            </div>
            <div class="user-info">
                <img src="images/ç®¡ç†å‘˜å›¾æ ‡.png">
                <span>ç®¡ç†å‘˜1</span>
            </div>
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 20px;"> 
            <div class="module" style="flex: 3; margin-bottom: 0;"> 
                <h2>ç®¡ç†ä¸šåŠ¡</h2>
                <div class="management-icons">
                    <div class="icon-box">
                        <a href="monitoring.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle door-icon">
                                <img src="images/é—¨ç¦ç®¡ç†.png">
                            </div>
                            <span>é—¨ç¦ç®¡ç†</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="owner-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle property-icon">
                                <img src="images/ä¸šä¸»ç®¡ç†.png">
                            </div>
                            <span>ä¸šä¸»ç®¡ç†</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="work-order.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle work-icon">
                                <img src="images/å·¥å•ç®¡ç†.png">
                            </div>
                            <span>å·¥å•ç®¡ç†</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="visitor-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle visitor-icon">
                                <img src="images/è®¿å®¢ç®¡ç†.png">
                            </div>
                            <span>è®¿å®¢ç®¡ç†</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="appointment-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle appointment-icon">
                                <img src="images/é¢„çº¦ç®¡ç†.png">
                            </div>
                            <span>é¢„çº¦ç®¡ç†</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="parking-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle parking-icon">
                                <img src="images/è½¦ä½ç®¡ç†.png">
                            </div>
                            <span>è½¦ä½ç®¡ç†</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="module" style="flex: 1; margin-bottom: 0;"> 
            <h2>é—¨ç¦å¼€å…³</h2>
                <div class="door-buttons" style="margin-top: 25px;">
                <button class="door-close">å…³é—¨</button>
                <button class="door-open">å¼€é—¨</button>
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
            <div style="width: 200px; display: flex; flex-direction: column; gap: 20px; flex-shrink: 0;">
                <div class="stat-card">
                    <h3>å‰©ä½™è½¦ä½</h3>
                    <div>
                        <span class="big-number" id="available-parking-spots" style="font-size: 36px; color: #4c6ef5;">XX</span>
                <span class="unit">ä¸ª</span>
            </div>
        </div>

                <div class="stat-card">
                    <h3>æ€»è½¦ä½</h3>
                    <div>
                        <span class="big-number" id="total-parking-spots" style="font-size: 36px; color: #4c6ef5;">XXX</span>
                <span class="unit">ä¸ª</span>
            </div>
                </div>
        </div>

            <div class="module" style="width: 300px; margin-bottom: 0; height: 280px; flex-shrink: 0;">
            <h2>ä¸šä¸»ç®¡ç†</h2>
                <div style="display: flex; flex-direction: column; align-items: center; height: 230px;">
                    <div style="width: 180px; height: 180px; position: relative; margin-bottom: 10px;">
                        <canvas id="propertyPieChart"></canvas>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                    <div class="legend-item">
                            <span class="color-dot" style="background-color: #4bc0c0;"></span>
                            <span>å·²é€šè¿‡</span>
                    </div>
                    <div class="legend-item">
                            <span class="color-dot" style="background-color: #ffcd56;"></span>
                            <span>å¾…å®¡æ ¸</span>
                    </div>
                   
                </div>
            </div>
                </div>

            <div class="module" style="flex: 1; margin-bottom: 0; height: 280px; display: flex; flex-direction: column;">
                <h2>å·¥å•ç®¡ç†</h2>
                <div style="display: flex; flex: 1; gap: 15px;">
                    <div style="display: flex; flex: 1; justify-content: space-between;">
                        <div style="flex: 1; text-align: center;">
                            <h3 style="font-size: 14px; margin-bottom: 5px;">æŠ¥ä¿®å·¥å•</h3>
                            <div style="position: relative; height: 150px;">
                                <canvas id="paymentOrderChart"></canvas>
                                <div class="chart-center-text">æŠ¥ä¿®å·¥å•</div>
                            </div>
                            <div class="doughnut-legend" style="margin-top: 5px; display: flex; justify-content: center; gap: 15px;">
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #4bc0c0;"></span>
                                    <span>å·²å®Œæˆ</span>
                                </div>
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #ffcd56;"></span>
                                    <span>å¾…ç»´ä¿®</span>
                                </div>
            </div>
        </div>

                        <div style="flex: 1; text-align: center;">
                            <h3 style="font-size: 14px; margin-bottom: 5px;">ç¼´è´¹å·¥å•</h3>
                            <div style="position: relative; height: 150px;">
                                <canvas id="repairOrderChart"></canvas>
                                <div class="chart-center-text">ç¼´è´¹å·¥å•</div>
                    </div>
                            <div class="doughnut-legend" style="margin-top: 5px; display: flex; justify-content: center; flex-wrap: wrap; gap: 10px;">
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #ffcd56;"></span>
                                    <span>å¾…ç¼´è´¹</span>
                </div>
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #4bc0c0;"></span>
                                    <span>å·²ç¼´è´¹</span>
                </div>
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #ff6384;"></span>
                                    <span>å·²å–æ¶ˆ</span>
                                </div>
                            </div>
                </div>
            </div>

                    <div style="width: 130px; flex-shrink: 0;">
                        <div style="background-color: #f0f2f5; border-radius: 8px; padding: 12px; height: 100%; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; font-size: 14px; margin-bottom: 10px;">å¾…ç»´ä¿®</h3>
                            <div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 15px;">ä¼˜å…ˆç¨‹åº¦</div>
                            <div style="flex: 1; display: flex; flex-direction: column; justify-content: center;">
                                <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 10px; height: 10px; border-radius: 50%; background-color: #ff6b6b; margin-right: 5px;"></div>
                                        <span style="color: #333;">é«˜</span>
                    </div>
                                    <span style="color: #333; font-weight: bold;">XXä»½</span>
                </div>
                                <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 10px; height: 10px; border-radius: 50%; background-color: #feca57; margin-right: 5px;"></div>
                                        <span style="color: #333;">ä¸­</span>
                </div>
                                    <span style="color: #333; font-weight: bold;">XXä»½</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 10px; height: 10px; border-radius: 50%; background-color: #1dd1a1; margin-right: 5px;"></div>
                                        <span style="color: #333;">ä½</span>
                                    </div>
                                    <span style="color: #333; font-weight: bold;">XXä»½</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="large-charts-grid">
            <div class="module">
                <h2>è®¿å®¢æƒ…å†µ</h2>
                <div style="position: relative; height: 230px;">
                    <canvas id="visitorChart"></canvas>
                </div>
            </div>

            <div class="module">
                <h2>æ£‹ç›˜å®¤é¢„çº¦æƒ…å†µ</h2>
              
                <div style="position: relative; height: 230px;">
                    <canvas id="reservationChart"></canvas>
                </div>
            </div>
        </div>
        <!-- Content from original #dashboard-view ends here -->
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–åœè½¦æ•°æ®å¹¶æ›´æ–°é¦–é¡µ
            getParkingDataForDashboard();
            
            // è·å–å¹¶æ˜¾ç¤ºè½¦ä½æ•°æ®
            async function getParkingDataForDashboard() {
                try {
                    // æ„å»ºAPIè¯·æ±‚å‚æ•°
                    const myHeaders = new Headers();
                    myHeaders.append("communityId", "1");
                    myHeaders.append("User-Agent", "Apifox/1.0.0 (https://apifox.com)");
                    myHeaders.append("Authorization", "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxIiwiZXhwIjoxODQyMDQ3MTc2fQ.eR8U4B92t6xoRjzKocEThKpVV3q674vb_oekgwgOr1Q");
                    myHeaders.append("Accept", "*/*");
                    myHeaders.append("Host", "property-func-dcwdljroao.cn-shenzhen.fcapp.run");
                    myHeaders.append("Connection", "keep-alive");
                    
                    const url = 'https://property-func-dcwdljroao.cn-shenzhen.fcapp.run/parking/get';
                    console.log("Dashboard - è¯·æ±‚åœè½¦æ•°æ®URL:", url);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: myHeaders,
                        redirect: 'follow'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error (${response.status})`);
                    }
                    
                    const data = await response.json();
                    console.log("Dashboard - åœè½¦æ•°æ®:", data);
                    
                    // æ›´æ–°é¦–é¡µè½¦ä½æ•°æ®æ˜¾ç¤º
                    if (data && data.data) {
                        const parkingData = data.data;
                        document.getElementById('total-parking-spots').textContent = parkingData.spaceNum || 'XX';
                        document.getElementById('available-parking-spots').textContent = parkingData.freeNum || 'XX';
                    }
                } catch (error) {
                    console.error("Dashboard - è·å–åœè½¦æ•°æ®å¤±è´¥:", error);
                }
            }
        });
    </script>
</body>
</html> 