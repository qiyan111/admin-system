<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小区物业后台管理系统 - 首页</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <h1>LOGO</h1>
            <p>小区物业后台管理</p>
        </div>
        <div class="menu">
             <a href="dashboard.html" class="menu-item">
                 <i>📄</i> 首页
             </a>
             <a href="monitoring.html" class="menu-item">
                 <i>🚪</i> 门禁监控
             </a>
             <a href="owner-management.html" class="menu-item">
                 <i>🏢</i> 业主管理
             </a>
             <a href="work-order.html" class="menu-item"> 
                 <i>📝</i> 工单管理
             </a>
             <a href="visitor-management.html" class="menu-item">
                 <i>👥</i> 访客管理
             </a>
             <a href="appointment-management.html" class="menu-item">
                 <i>📅</i> 预约管理
             </a>
             <a href="parking-management.html" class="menu-item">
                 <i>🅿️</i> 车位管理
             </a>
        </div>
    </div>

    <div class="main-content">
        <!-- Content from original #dashboard-view starts here -->
        <div class="header-bar">
            <div class="search-bar">
                <input type="text" placeholder="搜索...">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #666; margin-left: 5px;">
                    <path d="M11.7422 10.3438H11.1094L10.875 10.125C11.6562 9.21875 12.125 8.0625 12.125 6.8125C12.125 4.15625 9.96875 2 7.3125 2C4.65625 2 2.5 4.15625 2.5 6.8125C2.5 9.46875 4.65625 11.625 7.3125 11.625C8.5625 11.625 9.71875 11.1562 10.625 10.375L10.8438 10.6094V11.2422L14.8438 15.25L16.25 13.8438L11.7422 10.3438ZM7.3125 10.3438C5.40625 10.3438 3.875 8.8125 3.875 6.8125C3.875 4.8125 5.40625 3.28125 7.3125 3.28125C9.21875 3.28125 10.75 4.8125 10.75 6.8125C10.75 8.8125 9.21875 10.3438 7.3125 10.3438Z" fill="currentColor"/>
                </svg>
            </div>
            <div class="user-info">
                <img src="images/管理员图标.png">
                <span>管理员1</span>
            </div>
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 20px;"> 
            <div class="module" style="flex: 3; margin-bottom: 0;"> 
                <h2>管理业务</h2>
                <div class="management-icons">
                    <div class="icon-box">
                        <a href="monitoring.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle door-icon">
                                <img src="images/门禁管理.png">
                            </div>
                            <span>门禁管理</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="owner-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle property-icon">
                                <img src="images/业主管理.png">
                            </div>
                            <span>业主管理</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="work-order.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle work-icon">
                                <img src="images/工单管理.png">
                            </div>
                            <span>工单管理</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="visitor-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle visitor-icon">
                                <img src="images/访客管理.png">
                            </div>
                            <span>访客管理</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="appointment-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle appointment-icon">
                                <img src="images/预约管理.png">
                            </div>
                            <span>预约管理</span>
                        </a>
                    </div>
                    <div class="icon-box">
                        <a href="parking-management.html" style="text-decoration: none; color: inherit;">
                            <div class="icon-circle parking-icon">
                                <img src="images/车位管理.png">
                            </div>
                            <span>车位管理</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="module" style="flex: 1; margin-bottom: 0;"> 
            <h2>门禁开关</h2>
                <div class="door-buttons" style="margin-top: 25px;">
                <button class="door-close">关门</button>
                <button class="door-open">开门</button>
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
            <div style="width: 200px; display: flex; flex-direction: column; gap: 20px; flex-shrink: 0;">
                <div class="stat-card">
                    <h3>剩余车位</h3>
                    <div>
                        <span class="big-number" id="available-parking-spots" style="font-size: 36px; color: #4c6ef5;">XX</span>
                <span class="unit">个</span>
            </div>
        </div>

                <div class="stat-card">
                    <h3>总车位</h3>
                    <div>
                        <span class="big-number" id="total-parking-spots" style="font-size: 36px; color: #4c6ef5;">XXX</span>
                <span class="unit">个</span>
            </div>
                </div>
        </div>

            <div class="module" style="width: 300px; margin-bottom: 0; height: 280px; flex-shrink: 0;">
            <h2>业主管理</h2>
                <div style="display: flex; flex-direction: column; align-items: center; height: 230px;">
                    <div style="width: 180px; height: 180px; position: relative; margin-bottom: 10px;">
                        <canvas id="propertyPieChart"></canvas>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                    <div class="legend-item">
                            <span class="color-dot" style="background-color: #4bc0c0;"></span>
                            <span>已通过</span>
                    </div>
                    <div class="legend-item">
                            <span class="color-dot" style="background-color: #ffcd56;"></span>
                            <span>待审核</span>
                    </div>
                   
                </div>
            </div>
                </div>

            <div class="module" style="flex: 1; margin-bottom: 0; height: 280px; display: flex; flex-direction: column;">
                <h2>工单管理</h2>
                <div style="display: flex; flex: 1; gap: 15px;">
                    <div style="display: flex; flex: 1; justify-content: space-between;">
                        <div style="flex: 1; text-align: center;">
                            <h3 style="font-size: 14px; margin-bottom: 5px;">报修工单</h3>
                            <div style="position: relative; height: 150px;">
                                <canvas id="paymentOrderChart"></canvas>
                                <div class="chart-center-text">报修工单</div>
                            </div>
                            <div class="doughnut-legend" style="margin-top: 5px; display: flex; justify-content: center; gap: 15px;">
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #4bc0c0;"></span>
                                    <span>已完成</span>
                                </div>
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #ffcd56;"></span>
                                    <span>待维修</span>
                                </div>
            </div>
        </div>

                        <div style="flex: 1; text-align: center;">
                            <h3 style="font-size: 14px; margin-bottom: 5px;">缴费工单</h3>
                            <div style="position: relative; height: 150px;">
                                <canvas id="repairOrderChart"></canvas>
                                <div class="chart-center-text">缴费工单</div>
                    </div>
                            <div class="doughnut-legend" style="margin-top: 5px; display: flex; justify-content: center; flex-wrap: wrap; gap: 10px;">
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #ffcd56;"></span>
                                    <span>待缴费</span>
                </div>
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #4bc0c0;"></span>
                                    <span>已缴费</span>
                </div>
                                <div class="legend-item">
                                    <span class="color-dot" style="background-color: #ff6384;"></span>
                                    <span>已取消</span>
                                </div>
                            </div>
                </div>
            </div>

                    <div style="width: 130px; flex-shrink: 0;">
                        <div style="background-color: #f0f2f5; border-radius: 8px; padding: 12px; height: 100%; display: flex; flex-direction: column;">
                            <h3 style="text-align: center; font-size: 14px; margin-bottom: 10px;">待维修</h3>
                            <div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 15px;">优先程度</div>
                            <div style="flex: 1; display: flex; flex-direction: column; justify-content: center;">
                                <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 10px; height: 10px; border-radius: 50%; background-color: #ff6b6b; margin-right: 5px;"></div>
                                        <span style="color: #333;">高</span>
                    </div>
                                    <span style="color: #333; font-weight: bold;">XX份</span>
                </div>
                                <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 10px; height: 10px; border-radius: 50%; background-color: #feca57; margin-right: 5px;"></div>
                                        <span style="color: #333;">中</span>
                </div>
                                    <span style="color: #333; font-weight: bold;">XX份</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 10px; height: 10px; border-radius: 50%; background-color: #1dd1a1; margin-right: 5px;"></div>
                                        <span style="color: #333;">低</span>
                                    </div>
                                    <span style="color: #333; font-weight: bold;">XX份</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="large-charts-grid">
            <div class="module">
                <h2>访客情况</h2>
                <div style="position: relative; height: 230px;">
                    <canvas id="visitorChart"></canvas>
                </div>
            </div>

            <div class="module">
                <h2>棋盘室预约情况</h2>
              
                <div style="position: relative; height: 230px;">
                    <canvas id="reservationChart"></canvas>
                </div>
            </div>
        </div>
        <!-- Content from original #dashboard-view ends here -->
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取停车数据并更新首页
            getParkingDataForDashboard();
            
            // 获取并显示车位数据
            async function getParkingDataForDashboard() {
                try {
                    // 构建API请求参数
                    const myHeaders = new Headers();
                    myHeaders.append("communityId", "1");
                    myHeaders.append("User-Agent", "Apifox/1.0.0 (https://apifox.com)");
                    myHeaders.append("Authorization", "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxIiwiZXhwIjoxODQyMDQ3MTc2fQ.eR8U4B92t6xoRjzKocEThKpVV3q674vb_oekgwgOr1Q");
                    myHeaders.append("Accept", "*/*");
                    myHeaders.append("Host", "property-func-dcwdljroao.cn-shenzhen.fcapp.run");
                    myHeaders.append("Connection", "keep-alive");
                    
                    const url = 'https://property-func-dcwdljroao.cn-shenzhen.fcapp.run/parking/get';
                    console.log("Dashboard - 请求停车数据URL:", url);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: myHeaders,
                        redirect: 'follow'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error (${response.status})`);
                    }
                    
                    const data = await response.json();
                    console.log("Dashboard - 停车数据:", data);
                    
                    // 更新首页车位数据显示
                    if (data && data.data) {
                        const parkingData = data.data;
                        document.getElementById('total-parking-spots').textContent = parkingData.spaceNum || 'XX';
                        document.getElementById('available-parking-spots').textContent = parkingData.freeNum || 'XX';
                    }
                } catch (error) {
                    console.error("Dashboard - 获取停车数据失败:", error);
                }
            }
        });
    </script>
</body>
</html> 